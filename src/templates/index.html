<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>MoonChat</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">

    <!-- JS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>

</head>

<body>

    <div class="container-fluid p-2">
        <div class="container-main">

            <!-- SIDEBAR -->
            <div id="card-friends" class="card">

                <!-- USER HEADER -->
                <div class="p-2 border-bottom d-flex align-items-center">
                    <img class="UserIcon" src="{{ photo }}" alt="">
                    <div class="ms-2 flex-grow-1">
                        <strong>{{ username }}</strong>
                        <input id="username" value="{{ username }}" hidden>
                    </div>
                    <a href="/logout" class="btn btn-sm btn-secondary">Logout</a>
                </div>

                <!-- ACTIONS -->
                <div class="p-2 d-flex gap-2">
                    <button class="btn btn-success btn-sm flex-fill" data-bs-toggle="modal" data-bs-target="#Modal2">
                        Search
                    </button>
                    <button class="btn btn-success btn-sm flex-fill" data-bs-toggle="modal"
                        data-bs-target="#exampleModal">
                        New Group
                    </button>
                </div>

                <!-- FRIENDS / CHATS -->
                <div class="contentchats">

                    {% for f in friends %}
                    <div class="chat-hover p-2">
                        <a onclick="MostrarChat('{{ username }}','{{ f.0 }}','{{ f.1 }}')" href="#">
                            <div class="d-flex align-items-center">
                                <img class="UserIcon me-2" src="{{ f.0 }}">
                                <strong>{{ f.1 }}</strong>
                            </div>
                        </a>
                    </div>
                    {% endfor %}

                </div>
            </div>

            <!-- CHAT PANEL -->
            <div id="message" class="card">

                <div id="Messager">

                    <!-- CHAT HEADER -->
                    <div class="p-2 border-bottom d-flex align-items-center">
                        <img class="UserIcon" id="img-message" src="">
                        <input id="groupNameMsg" class="form-control border-0 fw-bold" readonly>
                        <button id="Salir" class="btn btn-success btn-sm ms-auto">
                            <i class="fas fa-arrow-left"></i>
                        </button>

                    </div>

                    <!-- MESSAGES -->
                    <div class="content-msg">
                        <div id="texto-msj" class="texto-msj Scroll"></div>
                    </div>

                    <!-- INPUT -->
                    <div class="inputchat d-flex gap-2">
                        <input id="mi-msj" class="form-control" placeholder="Write your message">
                        <button id="Enviar">
                            <i class="fas fa-paper-plane"></i>
                        </button>

                    </div>

                </div>
            </div>

        </div>
    </div>

    <!-- MOBILE CHAT MODAL -->
    <div id="chatModal" class="modal fade" tabindex="-1">
        <div class="modal-dialog modal-fullscreen">
            <div class="modal-content content-mobilechat">

                <div id="Messager">

                    <div class="p-2 border-bottom d-flex align-items-center">
                        <img class="UserIcon" id="img-message2">
                        <input id="groupNameMsg2" class="form-control border-0 fw-bold" readonly>
                        <button class="btn btn-success ms-auto" data-bs-dismiss="modal">
                            <i class="fas fa-arrow-left"></i>
                        </button>
                    </div>

                    <div class="content-msg">
                        <div id="texto-msj2" class="texto-msj Scroll"></div>
                    </div>

                    <div class="inputchat d-flex gap-2">
                        <input id="mi-msj2" class="form-control" placeholder="Write your message">
                        <button id="Enviar2" class="btn btn-success">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>

                </div>

            </div>
        </div>
    </div>

    <!-- CREATE GROUP MODAL -->
    <div id="exampleModal" class="modal fade">
        <div class="modal-dialog">
            <form action="/create-group" method="post" class="modal-content">

                <div class="modal-header">
                    <h5>Create New Group</h5>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    <input name="groupName" class="form-control mb-2" placeholder="Group name">

                    <img id="img-preview" class="img-thumbnail mb-2">

                    <input type="file" id="img-uploader" class="form-control">

                    <progress id="img-upload-bar" value="0" max="100" style="width:100%; height:6px; margin-top:8px;">
                    </progress>

                    <input id="photo" name="photo" class="form-control mt-2" placeholder="Image URL">

                </div>

                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button class="btn btn-primary">Create</button>
                </div>

            </form>
        </div>
    </div>

    <!-- SEARCH GROUP MODAL -->
    <div id="Modal2" class="modal fade">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">

                <div class="modal-header">
                    <h5>Search Group</h5>
                    <button class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">
                    <input id="searchGroupInput" class="form-control mb-3" placeholder="Type group name..."
                        autocomplete="off">

                    <div id="searchFeedback" class="text-muted small mb-2"></div>

                    <ul id="groupResults" class="list-group"></ul>
                </div>

            </div>
        </div>
    </div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/js/bootstrap.bundle.min.js"></script>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>

    <!-- âœ… AXIOS (OBLIGATORIO PARA photo.js) -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script src="{{ url_for('static', filename='js/photo.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>

</html>